<%- include('partials/header') %>

<div class="container mt-4">

  <!-- T√çTULO -->
  <h2><%= empresa.nombre %> - Vinculaciones</h2>
  <p>Total de v√≠nculos: <strong><%= vinculosCount %></strong></p>

  <!-- ACCIONES DE LA EMPRESA -->
  <div class="d-flex align-items-center gap-2 mb-4">

    <a href="/vinculaciones/empresas/<%= empresa._id %>/editar"
       class="btn btn-warning btn-sm d-flex align-items-center gap-1">
      <i class="bi bi-pencil"></i>
      Editar empresa
    </a>

<form id="formBorrarEmpresa"
      action="/vinculaciones/empresas/<%= empresa._id %>/borrar"
      method="POST"
      data-total="<%= vinculosCount %>"
      class="m-0">

  <button type="submit"
          class="btn btn-danger btn-sm d-flex align-items-center gap-1">
    <i class="bi bi-trash"></i>
    Borrar empresa
  </button>
</form>
</div> <!-- üî• ESTE FALTABA -->
  <!-- NUEVO CONTRATO -->
<a href="/contratos/nuevo/<%= empresa._id %>"
   class="btn btn-primary mb-3">
  <i class="bi bi-plus-circle"></i> Nuevo Contrato
</a>



  <!-- TABLA DE VINCULACIONES -->
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Folio</th>
        <th>PDF</th>
        <th>Tipo</th>
        <th>Vigencia</th>
        <th>Comentarios</th>
        <th>Acciones</th>
      </tr>
    </thead>

<tbody>
  <% if (vinculaciones.length === 0) { %>
    <tr>
      <td colspan="6" class="text-center">No hay vinculaciones a√∫n.</td>
    </tr>
  <% } %>

  <% vinculaciones.forEach(v => { %>
    <tr>
      <td><%= v.folio %></td>

      <td>
<% if (v.pdf) { %>
  <a href="/api/files/<%= v.pdf %>" target="_blank">
    <i class="bi bi-file-earmark-pdf"></i> Ver PDF
  </a>
<% } else { %>
  -
<% } %>

      </td>

      <td><%= v.tipo || '-' %></td>

      <td>
        <%= v.vigenciaInicio ? new Date(v.vigenciaInicio).toLocaleDateString('es-MX') : '-' %> 
        - 
        <%= v.vigenciaFin ? new Date(v.vigenciaFin).toLocaleDateString('es-MX') : '-' %>
      </td>

      <td><%= v.comentarios || '-' %></td>

      <td class="d-flex gap-2">
<a href="/contratos/ver/<%= v._id %>" class="btn btn-sm btn-info">
  Ver
</a>

<a href="/contratos/editar/<%= v._id %>" class="btn btn-sm btn-warning">
  Editar
</a>


        <form action="/vinculaciones/eliminar/<%= v._id %>" 
              method="POST" 
              onsubmit="return confirm('¬øEliminar esta vinculaci√≥n?');">
          <button type="submit" class="btn btn-sm btn-danger">
            Eliminar
          </button>
        </form>

      </td>

    </tr>
  <% }) %>
</tbody>

  </table>

  <!-- VOLVER -->
  <div class="mt-3">
    <a href="/vinculaciones/empresas" class="btn btn-secondary">
      Volver a empresas
    </a>
  </div>

</div>

<script src="/js/empresaVinculacion.js"></script>

<%- include('partials/footer') %>
