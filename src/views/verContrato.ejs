<%- include('partials/header', { title: 'Detalle Contrato' }) %>

<div class="container mt-4">

  <!-- HEADER CARD -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body d-flex justify-content-between align-items-center">

      <div>
        <h4 class="mb-1">Contrato <span class="text-primary"><%= contrato.folio %></span></h4>
        <p class="mb-0 text-muted">
          <i class="bi bi-building"></i>
          <%= contrato.empresa.nombre %>
        </p>
      </div>

      <div class="d-flex gap-2">
        <a href="/contratos/editar/<%= contrato._id %>" 
           class="btn btn-warning btn-sm">
          <i class="bi bi-pencil"></i> Editar
        </a>

        <a href="/vinculaciones/empresa/<%= contrato.empresa._id %>" 
           class="btn btn-secondary btn-sm">
          <i class="bi bi-arrow-left"></i> Volver
        </a>
      </div>

    </div>
  </div>


  <!-- METADATOS -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <h5 class="mb-4 text-primary">
        <i class="bi bi-info-circle"></i> Información General
      </h5>

      <div class="row g-3">

        <div class="col-md-6">
          <strong>Titular</strong>
          <div class="text-muted"><%= contrato.titular || '-' %></div>
        </div>

        <div class="col-md-6">
          <strong>Cargo</strong>
          <div class="text-muted"><%= contrato.cargo || '-' %></div>
        </div>

        <div class="col-md-6">
          <strong>Correo</strong>
          <div class="text-muted"><%= contrato.correo || '-' %></div>
        </div>

        <div class="col-md-6">
          <strong>Apoderado Legal</strong>
          <div class="text-muted"><%= contrato.apoderadoLegal || '-' %></div>
        </div>

        <div class="col-md-6">
          <strong>Vigencia Inicio</strong>
          <div class="text-muted">
            <%= contrato.vigenciaInicio ? contrato.vigenciaInicio.toLocaleDateString() : '-' %>
          </div>
        </div>

        <div class="col-md-6">
          <strong>Vigencia Fin</strong>
          <div class="text-muted">
            <%= contrato.vigenciaFin ? contrato.vigenciaFin.toLocaleDateString() : '-' %>
          </div>
        </div>

        <div class="col-md-4">
          <strong>Año</strong>
          <div class="text-muted"><%= contrato.anio || '-' %></div>
        </div>

        <div class="col-md-4">
          <strong>Código</strong>
          <div class="text-muted"><%= contrato.codigo || '-' %></div>
        </div>

        <div class="col-md-4">
          <strong>RFC</strong>
          <div class="text-muted"><%= contrato.rfc || '-' %></div>
        </div>

        <div class="col-md-6">
          <strong>Nacionalidad</strong>
          <div class="text-muted"><%= contrato.nacionalidad || '-' %></div>
        </div>

        <div class="col-md-6">
          <strong>Cuenta con INE</strong>
          <div>
            <% if (contrato.cuentaINE) { %>
              <span class="badge bg-success">Sí</span>
            <% } else { %>
              <span class="badge bg-secondary">No</span>
            <% } %>
          </div>
        </div>

      </div>
    </div>
  </div>


  <!-- PDF CARD -->
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <h5 class="mb-4 text-primary">
        <i class="bi bi-file-earmark-pdf"></i> Documento PDF
      </h5>

      <% if (contrato.pdf) { %>

        <div class="d-flex gap-2 flex-wrap">
          <a href="/api/files/<%= contrato.pdf %>" 
             target="_blank"
             class="btn btn-success">
            <i class="bi bi-eye"></i> Ver PDF
          </a>

          <form action="/contratos/eliminar-pdf/<%= contrato._id %>" 
                method="POST">
            <button class="btn btn-danger">
              <i class="bi bi-trash"></i> Eliminar
            </button>
          </form>
        </div>

      <% } else { %>

        <div class="alert alert-light border">
          No hay PDF adjunto.
        </div>

      <% } %>

      <hr>

      <form action="/contratos/subir-pdf/<%= contrato._id %>" 
            method="POST" 
            enctype="multipart/form-data">

        <div class="row g-2 align-items-center">
          <div class="col-md-8">
            <input type="file" 
                   name="pdf" 
                   accept="application/pdf" 
                   class="form-control"
                   required>
          </div>

          <div class="col-md-4">
            <button class="btn btn-primary w-100">
              <i class="bi bi-upload"></i> Subir / Reemplazar
            </button>
          </div>
        </div>

      </form>

    </div>
  </div>

</div>

<%- include('partials/footer') %>