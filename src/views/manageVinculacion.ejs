<%- include('partials/header', { title: 'Empresas Vinculadas' }) %>

<div class="container mt-4">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-semibold text-primary mb-0">Empresas Vinculadas</h2>
    <a href="/vinculaciones/nuevo" class="btn btn-outline-primary btn-sm shadow-sm">
      <i class="bi bi-plus"></i> Nueva Empresa / Vínculo
    </a>
  </div>

  <!-- BUSCADOR Y ORDEN -->
  <form class="row g-2 mb-4" method="GET" action="/vinculaciones/empresas">
    <div class="col-md-6">
      <input type="text" name="search" class="form-control form-control-sm" 
             placeholder="Buscar empresa..." value="<%= search %>">
    </div>
    <div class="col-md-4">
      <select name="sort" class="form-select form-select-sm">
        <option value="nombre-asc" <%= sort === 'nombre-asc' ? 'selected' : '' %>>A-Z</option>
        <option value="nombre-desc" <%= sort === 'nombre-desc' ? 'selected' : '' %>>Z-A</option>
        <option value="fecha-asc" <%= sort === 'fecha-asc' ? 'selected' : '' %>>Más antiguo</option>
        <option value="fecha-desc" <%= sort === 'fecha-desc' ? 'selected' : '' %>>Más reciente</option>
      </select>
    </div>
    <div class="col-md-2 d-grid">
      <button class="btn btn-primary btn-sm">
        <i class="bi bi-search"></i> Buscar
      </button>
    </div>
  </form>

  <!-- TABLA DE EMPRESAS -->
  <div class="table-responsive shadow-sm rounded">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light text-uppercase small">
        <tr>
          <th>Nombre</th>
          <th>Fecha de Alta</th>
          <th>Número de Contratos</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% if (empresas.length === 0) { %>
          <tr>
            <td colspan="4" class="text-center text-muted small">
              <i class="bi bi-exclamation-circle"></i> No se encontraron empresas.
            </td>
          </tr>
        <% } %>

        <% empresas.forEach(e => { %>
          <tr>
            <td class="fw-semibold text-primary"><i class="bi bi-building"></i> <%= e.nombre %></td>
            <td class="text-muted small"><%= new Date(e.createdAt).toLocaleDateString('es-MX') %></td>
            <td>
              <span class="badge bg-light text-dark"><%= e.contratosCount %></span>
            </td>
            <td class="text-end">
              <a href="/vinculaciones/empresa/<%= e._id %>" class="btn btn-outline-primary btn-sm me-1">
                <i class="bi bi-eye"></i>
              </a>
              <a href="/vinculaciones/empresas/<%= e._id %>/editar" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-pencil"></i>
              </a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

</div>

<script>
  const sortSelect = document.querySelector('select[name="sort"]');
  if(sortSelect){
    sortSelect.addEventListener('change', () => {
      sortSelect.form.submit();
    });
  }
</script>

<style>
  /* Hover suave y transición */
  .table-hover tbody tr:hover {
    background-color: rgba(0, 123, 255, 0.05);
    transition: background-color 0.2s ease-in-out;
  }

  /* Badges suaves */
  .badge {
    font-size: 0.75rem;
    padding: 0.25em 0.45em;
  }

  /* Botones compactos */
  .btn-sm {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
  }
</style>

<%- include('partials/footer') %>